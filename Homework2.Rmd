---
title: 'Homework Assignment2'
author: "ê¹€ê²½ë¯¼(20210344)"
header-includes:
  - \usepackage{kotex}
output: 
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

\newpage


#  Question 1
## Ozone Data
```{r}
library( ElemStatLearn )
data( ozone )
n = nrow( ozone ) ; p = 1

head( ozone )
```

íšŒê·€ì‹ $\text{ozone}_i = \beta_0 + \beta_1 \text{wind}_i + \epsilon_i$ì˜ ì„¤ëª…ë³€ìˆ˜ì™€ ë°˜ì‘ë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

* `y`: Ozone  ë²¡í„° $\in \mathbb{R}^n$
* `X`: Wind ë²¡í„° $\in \mathbb{R}^n$ 

```{r}
y = ozone$ozone 
x = ozone$wind 
```


ë’¤ì—ì„œ confidence intervalê³¼ predict interval ì„ êµ¬í•  ë•Œ í•„ìš”í•œ $\hat{\beta_0}, \hat{\beta_1}, \hat{\sigma}^2$ì„ ê³„ì‚°í•˜ì.

- `Sxx`: $S_{xx}$
- `Sxy`: $S_{xy}$
- `beta1_hat`: $\hat{\beta}_1$
- `beta0_hat`: $\hat{\beta}_0$
- `sse` : SSE
- `sigma2_hat`: $\hat{\sigma}^2$
```{r}
Sxx = sum( (x - mean(x))^2 )
Sxy = sum( (x - mean(x))*(y - mean(y)) )

beta1_hat = Sxy / Sxx
beta0_hat = mean(y) - beta1_hat * mean(x)

sse = sum( (y - ( beta0_hat + beta1_hat * x ) )^2 )
sigma2_hat = sse / (n - ( p + 1 ))


data.frame( beta0_hat, beta1_hat, sigma2_hat )
```

\newpage

## 1.1 Combine the results and make a dataframe `res` with columns.

- `wind`: the sequence of $x$

### Sequence of predictor
```{r}
xval = data.frame( wind = seq( min( ozone$wind ), max( ozone$wind), length.out = 20 ) )
c(head( xval ) , tail( xval ) )
```




### Confidence interval 
Mean response $\hat{\mu}_0 = \hat{\beta}_0 + \hat{\beta}_1 x_0$ì˜ í‘œì¤€ì˜¤ì°¨ $\text{SE}\left( \hat{\mu}_0\right)$ëŠ” $\sqrt{\hat{\sigma}^2 \left( \frac{1}{n} + \frac{ \left(x_0 - \bar{x}\right)^2 }{S_{xx}}\right)}$ì´ë‹¤. ë”°ë¼ì„œ  confidence intervalì˜ í•˜í•œì€ $\hat{\mu}_0 - t_{n-2, 1-\alpha / 2} \times \text{SE} \left( \hat{\mu}_0 \right)$ì´ê³  ìƒí•œì€ $\hat{\mu}_0 + t_{n-2, 1-\alpha / 2} \times \text{SE} \left( \hat{\mu}_0 \right)$ì´ë‹¤. 

- `qt0.025`: $t_{n-2,\, 0.025}$
- `se.fit`: $\text{SE}\left( \hat{\mu}_0\right)$
- `conf.lwr`: the lower limit of the confidence interval
- `conf.upr`: the upper limit of the confidence interval
```{r}
qt0.025 = qt(p = 0.025, df = n-2, lower.tail = FALSE)

conf.lwr = rep( 0, 20 ) ; conf.upr = rep( 0, 20 )
for( i in 1:20 ){
  se.fit = sqrt( sigma2_hat * ( (1/n) + (xval[i,1] - mean(x))^2 / Sxx ) )
  conf.lwr[i] = beta0_hat + beta1_hat * xval[i,1] - qt0.025 * se.fit 
  conf.upr[i] = beta0_hat + beta1_hat * xval[i,1] + qt0.025 * se.fit 
}

cbind(head( conf.lwr ), head( conf.upr ))
```
\newpage

### Predict interval 
Prediction value of the response $\hat{Y}_0 = \hat{\beta}_0 + \hat{\beta}_1 x_0 + \epsilon_0$ì˜ í‘œì¤€ì˜¤ì°¨ $\text{SE}\left( \hat{Y}_0\right)$ëŠ” $\sqrt{\hat{\sigma}^2 \left( 1 + \frac{1}{n} + \frac{ \left(x_0 - \bar{x}\right)^2 }{S_{xx}}\right)}$ì´ë‹¤. ë”°ë¼ì„œ  confidence intervalì˜ í•˜í•œì€ $\hat{Y}_0 - t_{n-2, 1-\alpha / 2} \times \text{SE} \left( \hat{Y}_0 \right)$ì´ê³  ìƒí•œì€ $\hat{Y}_0 + t_{n-2, 1-\alpha / 2} \times \text{SE} \left( \hat{Y}_0 \right)$ì´ë‹¤. 

- `qt0.025`: $t_{n-2,\, 0.025}$
- `se.pred`: $\text{SE}\left( \hat{Y}_0\right)$
- `pred.lwr`: the lower limit of the prediction interval
- `pred.upr`: the upper limit of the prediction interval


```{r}
qt0.025 = qt(p = 0.025, df = n-2, lower.tail = FALSE)

pred.lwr = rep( 0, 20 ) ; pred.upr = rep( 0, 20 )
for( i in 1:20 ){
  se.pred = sqrt( sigma2_hat * ( 1 + (1/n) + (xval[i,1] - mean(x))^2 / Sxx ) )
  pred.lwr[i] = beta0_hat + beta1_hat * xval[i,1] - qt0.025 * se.pred 
  pred.upr[i] = beta0_hat + beta1_hat * xval[i,1] + qt0.025 * se.pred 
}
```


### Make a dataframe `res`
```{r}
res = data.frame( "wind" = xval,
                  "conf.lwr" = conf.lwr,
                  "conf.upr" = conf.upr,
                  "pred.lwr" = pred.lwr,
                  "pred.upr" = pred.upr )

res
```

\newpage


# Question 2
## Ozone Data
```{r}
rm(list = ls())
library(ElemStatLearn)
data(ozone)
n = nrow( ozone )
p = 3

y = matrix( ozone$ozone )
X = cbind( "(intercept)" = rep(1,n),
           "wind" = ozone$wind,
           "temperature" = ozone$temperature,
           "radiation" = ozone$radiation )
```

## 1.1 Compute the ğ¹-statistic using SSE and SSR of the full model and save it in fstat_1.
```{r}
beta_hat = solve( t(X) %*% X ) %*% t(X) %*% y
data.frame( beta_hat )

y_hat = X %*% beta_hat
resid = y - y_hat
SSE = sum( resid^2 )
SST = sum( (y - mean(y))^2 )
SSR = SST - SSE

# Anova Table
Source = c( "Regression", "Error", "Total" )
df = c( p, n - ( p + 1 ), n - 1 )
SS = c( SSR, SSE, SST )
MS = c( SSR / p, SSE / ( n - ( p + 1 ) ), NA )
Fstat = c(MS[1] / MS[2], NA, NA)

data.frame( Source,df, SS, MS, Fstat )
fstat_1 = Fstat[1] 
fstat_1
```
\textcolor{red}{ë‹µì€ `r fstat_1`ì´ë‹¤.}


## 1.2 Compute the F-statisticc and save it fstat_2
```{r}
X_r = matrix(X[,1])
beta_hat_r = as.numeric(solve( t(X_r)%*% X_r ) %*% t(X_r) %*% y) 

SSE_r = sum( (y - X_r * beta_hat_r)^2 )
SST_r = SST 
SSR_r = SST_r - SSE_r

fstat_2 = (( SSE_r - SSE ) / p) / ( SSE / (n - ( p + 1 ) ) )
fstat_2
```
\textcolor{red}{ë‹µì€ 54.9066261ë¡œ ë¬¸ì œ 2.1ë²ˆì—ì„œ êµ¬í•œ ê°’ê³¼ ë™ì¼í•˜ë‹¤.}


## 1.3 Since SSE(RM) = SST, we know that the two test statistics are analytically same. How about the two statistics, fstat_1 and fstat_2?

ë¬¸ì œì—ì„œ ì„¤ëª…í•œëŒ€ë¡œ $\text{SSE}_{RM} = \text{SST}_{FM}$ì„ì„ ì´ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤.
$$
\begin{aligned}
\text{fstat_2} &= \dfrac{\left( \text{SSE}_{RM} - \text{SSE}_{FM} \right) / \left( \text{df}_{RM} - \text{df}_{FM} \right)}{\text{SSE}_{FM} / \text{df}_{FM}} \\
               &= \dfrac{\left( \text{SST}_{FM} - \text{SSE}_{FM} \right) / \left( \text{df}_{RM} - \text{df}_{FM} \right)}{\text{SSE}_{FM} / \text{df}_{FM}} \\
               &= \dfrac{ \text{SSR}_{FM} / p}{\text{SSE}_{FM} / n - \left( p+1\right)} \\
               &= \text{fstat_1}
\end{aligned}

$$
ê²°ê³¼ì ìœ¼ë¡œ `fstat_1`ê³¼ `fstat_2`ê°€ ê°™ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.



























